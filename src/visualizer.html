<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEO 분석 대시보드</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .score-ring {
            position: relative;
            width: 120px;
            height: 120px;
        }
        .score-ring svg {
            transform: rotate(-90deg);
        }
        .score-ring .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: bold;
        }
        .query-card {
            transition: all 0.3s ease;
        }
        .query-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .recommendation-card {
            border-left: 4px solid;
        }
        .p0 { border-left-color: #ef4444; }
        .p1 { border-left-color: #f59e0b; }
        .p2 { border-left-color: #10b981; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800" id="brand-name">AEO 분석 대시보드</h1>
                    <p class="text-gray-600 mt-2" id="analysis-date">불러오는 중...</p>
                </div>
                <div class="score-ring">
                    <svg width="120" height="120">
                        <circle cx="60" cy="60" r="50" fill="none" stroke="#e5e7eb" stroke-width="8"/>
                        <circle cx="60" cy="60" r="50" fill="none" stroke="#3b82f6" stroke-width="8" 
                                stroke-dasharray="314" stroke-dashoffset="314" id="score-circle"/>
                    </svg>
                    <div class="score-text" id="total-score">0</div>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex items-center space-x-4">
                    <span class="px-3 py-1 rounded-full text-sm font-medium" id="score-category">Loading...</span>
                    <span class="text-gray-600" id="queries-analyzed">0 queries analyzed</span>
                    <span class="text-gray-600" id="competitor-insights">0 competitor insights</span>
                </div>
            </div>
        </div>

        <!-- Query Performance Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8" id="query-grid">
            <!-- Query cards will be inserted here -->
        </div>

        <!-- AEO Score Breakdown -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">AEO 점수 상세</h2>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4" id="pillar-scores">
                <!-- Pillar scores will be inserted here -->
            </div>
            <div class="mt-6">
                <canvas id="pillar-chart" width="400" height="200"></canvas>
            </div>
            <div class="mt-6" id="pillar-explain"></div>
        </div>

        <!-- Recommendations -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">우선순위 개선안</h2>
            <div class="space-y-4" id="recommendations-list">
                <!-- Recommendations will be inserted here -->
            </div>
        </div>

        <!-- Competitor Analysis -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">경쟁 페이지 분석</h2>
            <div id="competitor-analysis">
                <!-- Competitor analysis will be inserted here -->
            </div>
        </div>
        
        <!-- Content Strategy Generator -->
        <div class="bg-white rounded-lg shadow-lg p-6 mt-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">브랜드 콘텐츠 전략</h2>
            <p class="text-gray-600 mb-6">각 쿼리별로 경쟁 페이지의 강점을 반영하여, 검색/AEO에서 상위 노출을 달성하기 위한 구체적인 실행 전략을 제시합니다.</p>
            <div class="space-y-4" id="content-strategy">
                <!-- Strategy content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Load Results Button -->
    <div class="fixed bottom-6 right-6">
        <button onclick="loadResults()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg shadow-lg transition-colors">
            최신 결과 불러오기
        </button>
    </div>

    <script>
        let aeoData = null;

        // Sample data structure (will be replaced by actual results)
        const sampleData = {
            timestamp: new Date().toISOString(),
            brand: "LG",
            queries: ["스마트 TV", "프리미엄 가전", "에어컨"],
            summary: {
                totalScore: 65,
                scoreCategory: "AEO Competitor",
                queriesAnalyzed: 3,
                competitorInsights: 9,
                queryPerformance: {
                    "스마트 TV": {
                        google: { topPosition: 7, totalMentions: 2, visibilityScore: 60 },
                        perplexity: { aiVisibility: 70, competitivePosition: 93, combined: 65.6 }
                    },
                    "프리미엄 가전": {
                        google: { topPosition: 2, totalMentions: 1, visibilityScore: 100 },
                        perplexity: { aiVisibility: 70, competitivePosition: 0, combined: 29 }
                    },
                    "에어컨": {
                        google: { topPosition: null, totalMentions: 0, visibilityScore: 0 },
                        perplexity: { aiVisibility: 0, competitivePosition: 97, combined: 49.4 }
                    }
                }
            },
            steps: {
                aeoScore: {
                    total: 65,
                    pillars: [
                        { name: "On-Page Structure", subtotal: 8, items: [] },
                        { name: "E-E-A-T & Content Quality", subtotal: 15, items: [] },
                        { name: "Off-Site Authority", subtotal: 18, items: [] },
                        { name: "Technical Foundation", subtotal: 12, items: [] },
                        { name: "Direct AEO Performance", subtotal: 12, items: [] }
                    ]
                },
                recommendations: {
                    items: [
                        {
                            category: "On-Page Structure",
                            priority: "P0",
                            impact: "high",
                            effort: "low",
                            description: "Add question-based H2 headings for each query category",
                            suggestion_snippet: "## 스마트 TV 추천 2025년 최고 모델은?\n\nLG OLED TV는 깊은 블랙과 넓은 시야각으로 프리미엄 시청 경험을 제공합니다. webOS 플랫폼과 함께 사용자 친화적인 인터페이스를 자랑합니다.",
                            metric: "H2 question coverage rate"
                        },
                        {
                            category: "E-E-A-T",
                            priority: "P1",
                            impact: "high",
                            effort: "medium",
                            description: "Create comprehensive comparison tables vs competitors",
                            suggestion_snippet: "| 브랜드 | 기술 | 장점 | 가격대 |\n|------|------|------|------|\n| LG | OLED, webOS | 깊은 블랙, 넓은 시야각 | 프리미엄 |\n| Samsung | QLED, Tizen | 높은 밝기, 생생한 색상 | 중고가 |",
                            metric: "Comparison table engagement"
                        }
                    ]
                }
            }
        };

        function initializeDashboard(data = sampleData) {
            aeoData = data;
            
            // Update header
            document.getElementById('brand-name').textContent = `${data.brand} AEO Analysis`;
            document.getElementById('analysis-date').textContent = `Analysis Date: ${new Date(data.timestamp).toLocaleDateString()}`;
            document.getElementById('queries-analyzed').textContent = `${data.summary.queriesAnalyzed} queries analyzed`;
            document.getElementById('competitor-insights').textContent = `${data.summary.competitorInsights} competitor insights`;
            
            // Update total score
            updateScoreRing(data.summary.totalScore);
            updateScoreCategory(data.summary.scoreCategory);
            
            // Render components
            renderQueryGrid(data.queries, data.summary.queryPerformance);
            renderPillarScores(data.steps.aeoScore);
            renderRecommendations(data.steps.recommendations.recommendations);
            renderCompetitorAnalysis(data);
            renderPillarExplain(data.steps.aeoScore);
            generateContentStrategy(data);
        }

        function updateScoreRing(score) {
            const circle = document.getElementById('score-circle');
            const scoreText = document.getElementById('total-score');
            
            const circumference = 2 * Math.PI * 50;
            const offset = circumference - (score / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            scoreText.textContent = score;
            
            // Color based on score
            if (score >= 75) circle.style.stroke = '#10b981';
            else if (score >= 50) circle.style.stroke = '#f59e0b';
            else circle.style.stroke = '#ef4444';
        }

        function updateScoreCategory(category) {
            const element = document.getElementById('score-category');
            element.textContent = category;
            
            // Style based on category
            element.className = 'px-3 py-1 rounded-full text-sm font-medium ';
            if (category.includes('Dominator') || category.includes('Leader')) {
                element.className += 'bg-green-100 text-green-800';
            } else if (category.includes('Competitor')) {
                element.className += 'bg-yellow-100 text-yellow-800';
            } else {
                element.className += 'bg-red-100 text-red-800';
            }
        }

        function renderQueryGrid(queries, performance) {
            const grid = document.getElementById('query-grid');
            grid.innerHTML = '';
            
            queries.forEach(query => {
                const perf = performance[query] || {};
                const googleScore = perf.google?.visibilityScore || 0;
                const perplexityScore = perf.perplexity?.combined || 0;
                
                const card = document.createElement('div');
                card.className = 'query-card bg-white rounded-lg shadow p-6';
                card.innerHTML = `
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">${query}</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">구글 가시성</span>
                            <div class="flex items-center">
                                <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${googleScore}%"></div>
                                </div>
                                <span class="text-sm font-medium">${googleScore}%</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-600">퍼플렉시티 점수</span>
                            <div class="flex items-center">
                                <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-purple-600 h-2 rounded-full" style="width: ${perplexityScore}%"></div>
                                </div>
                                <span class="text-sm font-medium">${perplexityScore.toFixed(1)}%</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mt-2">
                            구글 순위: ${perf.google?.topPosition || '순위 없음'} | 
                            언급수: ${perf.google?.totalMentions || 0}
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function renderPillarScores(aeoScore) {
            const container = document.getElementById('pillar-scores');
            container.innerHTML = '';
            
            const maxScores = [15, 25, 30, 15, 15]; // Max points per pillar
            
            aeoScore.pillars.forEach((pillar, index) => {
                const percentage = (pillar.subtotal / maxScores[index]) * 100;
                
                const pillarDiv = document.createElement('div');
                pillarDiv.className = 'text-center';
                pillarDiv.innerHTML = `
                    <div class="text-2xl font-bold text-gray-800">${pillar.subtotal}/${maxScores[index]}</div>
                    <div class="text-sm text-gray-600 mb-2">${pillar.name}</div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                `;
                container.appendChild(pillarDiv);
            });
            
            // Render chart
            renderPillarChart(aeoScore.pillars, maxScores);
        }

        function renderPillarExplain(aeoScore) {
            const container = document.getElementById('pillar-explain');
            if (!aeoScore || !aeoScore.pillars) { 
                container.innerHTML = ''; 
                return; 
            }
            
            const maxScores = [15, 25, 30, 15, 15];
            const explanations = {
                'On-Page Structure': '질문형 H2/H3, 첫 문단 정답(40~60자), 표/목록 구조화, 사실(숫자/날짜) 밀도를 평가합니다.',
                'E-E-A-T & Content Quality': '경험/전문성/권위/신뢰 신호(작가 이력, 출처 인용, 최신성, 정책/연락처 등)를 점검합니다.',
                'Off-Site Authority': '미디어 언급, 커뮤니티 존재감, 전문가 인용, 엔터티 일관성을 평가합니다.',
                'Technical Foundation': 'Core Web Vitals, 모바일 적합성, Organization/Article/FAQ/HowTo/Product 등 스키마 적용을 점검합니다.',
                'Direct AEO Performance': 'AI Overviews 노출, 챗봇 추천/언급, 브랜드 검색량 증가 등 직접 성과를 반영합니다.'
            };
            
            let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
            aeoScore.pillars.forEach((pillar, i) => {
                const max = maxScores[i] || 0;
                const explanation = explanations[pillar.name] || '설명 없음';
                html += `
                    <div class="bg-gray-50 p-4 rounded">
                        <div class="flex items-center justify-between mb-1">
                            <div class="font-semibold text-gray-800">${pillar.name}</div>
                            <div class="text-sm text-gray-600">${pillar.subtotal}/${max}</div>
                        </div>
                        <div class="text-sm text-gray-600">${explanation}</div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function renderPillarChart(pillars, maxScores) {
            const ctx = document.getElementById('pillar-chart').getContext('2d');
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: pillars.map(p => p.name.split(' ')[0]), // Shortened labels
                    datasets: [{
                        label: 'Current Score',
                        data: pillars.map(p => p.subtotal),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        pointBackgroundColor: '#3b82f6'
                    }, {
                        label: 'Max Score',
                        data: maxScores,
                        borderColor: '#e5e7eb',
                        backgroundColor: 'rgba(229, 231, 235, 0.1)',
                        pointBackgroundColor: '#e5e7eb'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: Math.max(...maxScores)
                        }
                    }
                }
            });
        }

        function renderRecommendations(recommendations) {
            const container = document.getElementById('recommendations-list');
            container.innerHTML = '';
            
            recommendations.forEach(rec => {
                const card = document.createElement('div');
                card.className = `recommendation-card bg-gray-50 p-4 rounded-lg ${rec.priority.toLowerCase()}`;
                card.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="px-2 py-1 text-xs font-medium rounded ${getPriorityClass(rec.priority)}">우선순위 ${rec.priority}</span>
                                <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">${rec.category}</span>
                                <span class="text-xs text-gray-500">영향도: ${rec.impact} | 노력도: ${rec.effort}</span>
                            </div>
                            <h4 class="font-semibold text-gray-800 mb-2">${rec.description}</h4>
                            <div class="bg-white p-3 rounded border-l-4 border-blue-500 mb-2">
                                <pre class="text-sm text-gray-700 whitespace-pre-wrap">${rec.suggestion_snippet}</pre>
                            </div>
                            <div class="text-xs text-gray-500">측정 지표: ${rec.metric}</div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function getPriorityClass(priority) {
            switch(priority) {
                case 'P0': return 'bg-red-100 text-red-800';
                case 'P1': return 'bg-yellow-100 text-yellow-800';
                case 'P2': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function renderCompetitorAnalysis(data) {
            const container = document.getElementById('competitor-analysis');
            
            if (data.steps.pageAudits) {
                let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
                
                Object.entries(data.steps.pageAudits).forEach(([query, audits]) => {
                    html += `<div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-3">${query}</h4>`;
                    
                    audits.slice(0, 3).forEach(audit => {
                        html += `<div class="bg-white p-3 rounded mb-2 text-sm">
                            <div class="font-medium text-blue-600">${audit.domain}</div>
                            <div class="text-gray-600 text-xs mt-1">${audit.whyItRanks}</div>
                        </div>`;
                    });
                    
                    html += '</div>';
                });
                
                html += '</div>';
                container.innerHTML = html;
            } else {
                container.innerHTML = '<p class="text-gray-500">경쟁 페이지 분석 데이터가 없습니다.</p>';
            }
        }
        
        function generateContentStrategy(data) {
            const container = document.getElementById('content-strategy');
            container.innerHTML = '';
            
            const queries = data.queries || [];
            const audits = data.steps.pageAudits || {};
            
            queries.forEach(query => {
                const auditItems = audits[query] || [];
                const competitorHighlights = auditItems.slice(0, 3).map(a => a.whyItRanks).join('\n- ');
                
                const card = document.createElement('div');
                card.className = 'bg-gray-50 p-4 rounded-lg';
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-semibold text-gray-800">${query}</h3>
                        <span class="text-xs text-gray-500">Strategy</span>
                    </div>
                    <div class="text-sm text-gray-700 space-y-3">
                        <div>
                            <div class="font-medium">1) Headline and Answer-First:</div>
                            <pre class="whitespace-pre-wrap bg-white p-2 rounded border">## ${query} 추천 2025년 최고의 선택은?

${query}에 추천되는 모델과 선택 기준을 50~80자로 명확하고 구체적으로 제시합니다. 가격대, 사용 사례, 핵심 장점을 한 문단으로 요약합니다.</pre>
                        </div>
                        <div>
                            <div class="font-medium">2) FAQ (JSON-LD ready):</div>
                            <pre class="whitespace-pre-wrap bg-white p-2 rounded border">{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {"@type":"Question","name":"${query} 어떻게 선택하나요?","acceptedAnswer":{"@type":"Answer","text":"용도(게임/영화), 밝기 환경, 화면 크기, 예산에 따라 3단계로 고르는 방법을 안내합니다."}},
    {"@type":"Question","name":"${query} 추천 브랜드는?","acceptedAnswer":{"@type":"Answer","text":"LG, Samsung, Sony 등 주요 브랜드의 강점과 추천 모델을 간결히 비교합니다."}}
  ]
}</pre>
                        </div>
                        <div>
                            <div class="font-medium">3) Comparison Table:</div>
                            <pre class="whitespace-pre-wrap bg-white p-2 rounded border">| 브랜드 | 핵심기술 | 강점 | 적합한 사용자 |
|---|---|---|---|
| LG | OLED, webOS | 깊은 블랙, 넓은 시야각 | 영화 감상, 정확한 색감 |
| Samsung | QLED, Tizen | 높은 밝기, 생생한 색 | 밝은 거실, 스포츠 |
| Sony | OLED, Google TV | 색정확도, 처리성능 | 시네필, 고급 사용자 |</pre>
                        </div>
                        <div>
                            <div class="font-medium">4) Why They Rank (Emulate):</div>
                            <pre class="whitespace-pre-wrap bg-white p-2 rounded border">- ${competitorHighlights || '경쟁 페이지 신호 없음'}

이 신호를 반영해 H2 질문형 구조, 첫 단락 정답 제시, FAQ/HowTo 스키마를 통합하고, 최신 통계와 모델명을 구체적으로 명시합니다.</pre>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        async function loadResults() {
            try {
                const response = await fetch('../output/aeo-results.json');
                if (response.ok) {
                    const data = await response.json();
                    initializeDashboard(data);
                    alert('결과를 불러왔습니다.');
                } else {
                    alert('결과 파일을 찾을 수 없습니다. 먼저 AEO 분석을 실행하세요.');
                }
            } catch (error) {
                console.error('Error loading results:', error);
                alert('결과 로딩 오류. 샘플 데이터를 사용합니다.');
                initializeDashboard(sampleData);
            }
        }

        // Initialize with sample data
        initializeDashboard(sampleData);
        generateContentStrategy(sampleData);
    </script>
</body>
</html>
